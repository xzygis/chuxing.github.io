<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Consul入门手册 - TechInsights - Chuxing's Blog</title><meta name=author content="chuxing"><meta name=author-link content="https://github.com/xzygis"><meta name=description content="Consul是什么？ Consul是一个服务发现和配置工具，它是分布式和高可用的，而且极易扩展。 Consul主要提供了以下特性： 服务发现：Consul使得服务注册和服务发现（通过DNS或HTTP接口）变得非常简单。 健康检查：健康检查使得Consul可以快速向管理员报告集群状况。将它与服务发现集成，可以"><meta name=keywords content="Consul"><meta itemprop=name content="Consul入门手册"><meta itemprop=description content="Consul是什么？ Consul是一个服务发现和配置工具，它是分布式和高可用的，而且极易扩展。 Consul主要提供了以下特性： 服务发现：Consul使得服务注册和服务发现（通过DNS或HTTP接口）变得非常简单。 健康检查：健康检查使得Consul可以快速向管理员报告集群状况。将它与服务发现集成，可以"><meta itemprop=datePublished content="2020-01-30T13:35:59+00:00"><meta itemprop=dateModified content="2022-12-10T14:35:38+08:00"><meta itemprop=wordCount content="3948"><meta itemprop=image content="https://xzygis.github.io/logo.png"><meta itemprop=keywords content="Consul,"><meta property="og:title" content="Consul入门手册"><meta property="og:description" content="Consul是什么？ Consul是一个服务发现和配置工具，它是分布式和高可用的，而且极易扩展。 Consul主要提供了以下特性： 服务发现：Consul使得服务注册和服务发现（通过DNS或HTTP接口）变得非常简单。 健康检查：健康检查使得Consul可以快速向管理员报告集群状况。将它与服务发现集成，可以"><meta property="og:type" content="article"><meta property="og:url" content="https://xzygis.github.io/posts/manual-of-consul/"><meta property="og:image" content="https://xzygis.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-30T13:35:59+00:00"><meta property="article:modified_time" content="2022-12-10T14:35:38+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://xzygis.github.io/logo.png"><meta name=twitter:title content="Consul入门手册"><meta name=twitter:description content="Consul是什么？ Consul是一个服务发现和配置工具，它是分布式和高可用的，而且极易扩展。 Consul主要提供了以下特性： 服务发现：Consul使得服务注册和服务发现（通过DNS或HTTP接口）变得非常简单。 健康检查：健康检查使得Consul可以快速向管理员报告集群状况。将它与服务发现集成，可以"><meta name=application-name content="技术洞察"><meta name=apple-mobile-web-app-title content="技术洞察"><meta name=theme-color data-light=#ffffff data-dark=#252627 content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://xzygis.github.io/posts/manual-of-consul/><link rel=prev href=https://xzygis.github.io/posts/usage-of-json-web-token/><link rel=next href=https://xzygis.github.io/posts/introduction-of-websocket/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Consul入门手册","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xzygis.github.io\/posts\/manual-of-consul\/"},"image":["https:\/\/xzygis.github.io\/site-meta.jpg"],"genre":"posts","keywords":"Consul","wordcount":3948,"url":"https:\/\/xzygis.github.io\/posts\/manual-of-consul\/","datePublished":"2020-01-30T13:35:59+00:00","dateModified":"2022-12-10T14:35:38+08:00","publisher":{"@type":"Organization","name":"xzygis","logo":"https:\/\/xzygis.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"chuxing"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="TechInsights - Chuxing's Blog"><img loading=lazy src=/logo.png srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" sizes=auto data-title="TechInsights - Chuxing's Blog" data-alt="TechInsights - Chuxing's Blog" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>TechInsights</span></a><span class=header-subtitle>Unity of Knowledge and Action</span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class=menu-item><a class=menu-link href=/about/ title=About>About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="TechInsights - Chuxing's Blog"><img loading=lazy src=/logo.png srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" sizes=auto data-title=/logo.png data-alt=/logo.png class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>TechInsights</span></a><span class=header-subtitle>Unity of Knowledge and Action</span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-user-tie fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class=menu-item><a class=menu-link href=/about/ title=About>About</a></li><li class="menu-item text-center"><a class=menu-link href=https://github.com/xzygis/xzygis.github.io title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Consul入门手册</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/xzygis title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
chuxing</a></span></div><div class=post-meta-line><span title="发布于 2020-01-30 13:35:59"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2020-01-30>2020-01-30</time></span>&nbsp;<span title="更新于 2022-12-10 14:35:38"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2022-12-10>2022-12-10</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 3948 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 8 分钟</span>&nbsp;<span id=/posts/manual-of-consul/ class="leancloud_visitors comment-visitors" data-flag-title=Consul入门手册>
<i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span class=leancloud-visitors-count>-</span>&nbsp;次阅读
</span>&nbsp;<span class=comment-count data-flag-title=Consul入门手册>
<i class="fa-regular fa-comments fa-fw me-1" aria-hidden=true></i><span data-xid=/posts/manual-of-consul/ class=valine-comment-count>-</span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#consul是什么>Consul是什么？</a><ul><li><a href=#基本架构>基本架构</a></li></ul></li><li><a href=#安装consul>安装Consul</a></li><li><a href=#运行agent>运行Agent</a><ul><li><a href=#启动agent>启动Agent</a></li><li><a href=#集群成员>集群成员</a></li><li><a href=#停止agent>停止Agent</a></li></ul></li><li><a href=#注册服务>注册服务</a><ul><li><a href=#定义一个服务>定义一个服务</a></li><li><a href=#查询服务>查询服务</a><ul><li><a href=#dns-api>DNS API</a></li><li><a href=#http-api>HTTP API</a></li></ul></li><li><a href=#更新服务>更新服务</a></li></ul></li></ul></nav></div></div><div class=content id=content data-end-flag=(End)><h2 id=consul是什么>Consul是什么？</h2><p>Consul是一个服务发现和配置工具，它是分布式和高可用的，而且极易扩展。</p><p>Consul主要提供了以下特性：</p><ol><li>服务发现：Consul使得服务注册和服务发现（通过DNS或HTTP接口）变得非常简单。</li><li>健康检查：健康检查使得Consul可以快速向管理员报告集群状况。将它与服务发现集成，可以防止流量路由到故障节点，实现服务熔断。</li><li>KV存储：灵活的KV存储，可用于尺寸出动态配置、功能特性、协调信息和选举信息等。简单的HTTP API使其易于在任何地方地方。</li><li>多数据中心：Consul支持多数据中心，不需要负责的配置就可以支持任意数量的数据中心。</li><li>服务鉴权（Service Segmentation）：Consul连接基于自动TLS加密和基于签名的鉴权实现安全的服务间通信。</li></ol><p>Consul支持Linux, Mac OS X, FreeBSD, Solaris, Windows等操作系统。</p><h3 id=基本架构>基本架构</h3><p>每个提供服务给Consul的节点都运行了一个Consul Agent。运行一个Agent并不需要对其他服务做发现或读写KV存储。Agent负责对该节点上的服务做健康检查。</p><p>Agent会与一个或多个Consul Server通信。Consul Server通常有多个实例，负责数据存储和备份、选举主节点等。虽然Consul支持在只有一个Server实例的情况下工具，但通常推荐使用3至5个实例，从而避免由于某些异常场景而导致数据丢失。同时，推荐在每个数据中心部署一个Consul集群。</p><p>每个数据中运行了一个Consul server集群。当一个跨数据中心的服务发现和配置请求创建时，本地Consul Server转发请求到远程的数据中心并返回结果.</p><h2 id=安装consul>安装Consul</h2><p>Consul集群的每个节点都必须先安装Consul，安装非常简单。在Mac上安装Consul命令如下：</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ brew install consul</span></span></code></pre></td></tr></table></div></div><p>安装成功后执行consul命令输出如下结果：</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ consul
</span></span><span class=line><span class=cl>Usage: consul [--version] [--help] &lt;command&gt; [&lt;args&gt;]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Available commands are:
</span></span><span class=line><span class=cl>    acl            Interact with Consul&#39;s ACLs
</span></span><span class=line><span class=cl>    agent          Runs a Consul agent
</span></span><span class=line><span class=cl>    catalog        Interact with the catalog
</span></span><span class=line><span class=cl>    config         Interact with Consul&#39;s Centralized Configurations
</span></span><span class=line><span class=cl>    connect        Interact with Consul Connect
</span></span><span class=line><span class=cl>    debug          Records a debugging archive for operators
</span></span><span class=line><span class=cl>    event          Fire a new event
</span></span><span class=line><span class=cl>    exec           Executes a command on Consul nodes
</span></span><span class=line><span class=cl>    force-leave    Forces a member of the cluster to enter the &#34;left&#34; state
</span></span><span class=line><span class=cl>    info           Provides debugging information for operators.
</span></span><span class=line><span class=cl>    intention      Interact with Connect service intentions
</span></span><span class=line><span class=cl>    join           Tell Consul agent to join cluster
</span></span><span class=line><span class=cl>    keygen         Generates a new encryption key
</span></span><span class=line><span class=cl>    keyring        Manages gossip layer encryption keys
</span></span><span class=line><span class=cl>    kv             Interact with the key-value store
</span></span><span class=line><span class=cl>    leave          Gracefully leaves the Consul cluster and shuts down
</span></span><span class=line><span class=cl>    lock           Execute a command holding a lock
</span></span><span class=line><span class=cl>    login          Login to Consul using an auth method
</span></span><span class=line><span class=cl>    logout         Destroy a Consul token created with login
</span></span><span class=line><span class=cl>    maint          Controls node or service maintenance mode
</span></span><span class=line><span class=cl>    members        Lists the members of a Consul cluster
</span></span><span class=line><span class=cl>    monitor        Stream logs from a Consul agent
</span></span><span class=line><span class=cl>    operator       Provides cluster-level tools for Consul operators
</span></span><span class=line><span class=cl>    reload         Triggers the agent to reload configuration files
</span></span><span class=line><span class=cl>    rtt            Estimates network round trip time between nodes
</span></span><span class=line><span class=cl>    services       Interact with services
</span></span><span class=line><span class=cl>    snapshot       Saves, restores and inspects snapshots of Consul server state
</span></span><span class=line><span class=cl>    tls            Builtin helpers for creating CAs and certificates
</span></span><span class=line><span class=cl>    validate       Validate config files/directories
</span></span><span class=line><span class=cl>    version        Prints the Consul version
</span></span><span class=line><span class=cl>    watch          Watch for changes in Consul</span></span></code></pre></td></tr></table></div></div><h2 id=运行agent>运行Agent</h2><p>完成Consul的安装后，可运行Agent。Agent可以运行为Server或Client模式。每个数据中心至少必须拥有一台server，建议在一个集群中部署或者3至5个Server。部署单一的Server，在出现失败时会不可避免的造成数据丢失.</p><p>其他的Agent运行为Client模式，一个Client是一个非常轻量级的进程，用于注册服务，运行健康检查和转发对Server的查询，Agent必须在集群中的每个主机上运行。</p><h3 id=启动agent>启动Agent</h3><p>命令<code>consul agent -dev</code>可以启动一个开发模式的Agent，这种模式不能用于生产环境，因为它不持久化任何状态。</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ consul agent -dev
</span></span><span class=line><span class=cl>==&gt; Starting Consul agent...
</span></span><span class=line><span class=cl>           Version: &#39;v1.6.1&#39;
</span></span><span class=line><span class=cl>           Node ID: &#39;2e524113-7caf-643a-80bb-a2fa00c2673b&#39;
</span></span><span class=line><span class=cl>         Node name: &#39;C02Z35N9LVCF&#39;
</span></span><span class=line><span class=cl>        Datacenter: &#39;dc1&#39; (Segment: &#39;&lt;all&gt;&#39;)
</span></span><span class=line><span class=cl>            Server: true (Bootstrap: false)
</span></span><span class=line><span class=cl>       Client Addr: [127.0.0.1] (HTTP: 8500, HTTPS: -1, gRPC: 8502, DNS: 8600)
</span></span><span class=line><span class=cl>      Cluster Addr: 127.0.0.1 (LAN: 8301, WAN: 8302)
</span></span><span class=line><span class=cl>           Encrypt: Gossip: false, TLS-Outgoing: false, TLS-Incoming: false, Auto-Encrypt-TLS: false
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>==&gt; Log data will now stream in as it occurs:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] agent: Using random ID &#34;2e524113-7caf-643a-80bb-a2fa00c2673b&#34; as node ID
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] tlsutil: Update with version 1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] tlsutil: OutgoingRPCWrapper with version 1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO]  raft: Initial configuration (index=1): [{Suffrage:Voter ID:2e524113-7caf-643a-80bb-a2fa00c2673b Address:127.0.0.1:8300}]
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO]  raft: Node at 127.0.0.1:8300 [Follower] entering Follower state (Leader: &#34;&#34;)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] serf: EventMemberJoin: C02Z35N9LVCF.dc1 127.0.0.1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] serf: EventMemberJoin: C02Z35N9LVCF 127.0.0.1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] consul: Adding LAN server C02Z35N9LVCF (Addr: tcp/127.0.0.1:8300) (DC: dc1)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] consul: Handled member-join event for server &#34;C02Z35N9LVCF.dc1&#34; in area &#34;wan&#34;
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: Started DNS server 127.0.0.1:8600 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: Started DNS server 127.0.0.1:8600 (udp)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: Started HTTP server on 127.0.0.1:8500 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: Started gRPC server on 127.0.0.1:8502 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: started state syncer
</span></span><span class=line><span class=cl>==&gt; Consul agent running!
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [WARN]  raft: Heartbeat timeout from &#34;&#34; reached, starting election
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO]  raft: Node at 127.0.0.1:8300 [Candidate] entering Candidate state in term 2
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] raft: Votes needed: 1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] raft: Vote granted from 2e524113-7caf-643a-80bb-a2fa00c2673b in term 2. Tally: 1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO]  raft: Election won. Tally: 1
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO]  raft: Node at 127.0.0.1:8300 [Leader] entering Leader state
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] consul: cluster leadership acquired
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] consul: New leader elected: C02Z35N9LVCF
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] connect: initialized primary datacenter CA with provider &#34;consul&#34;
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] consul: Skipping self join check for &#34;C02Z35N9LVCF&#34; since the cluster is too small
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] consul: member &#39;C02Z35N9LVCF&#39; joined, marking health alive
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] agent: Skipping remote check &#34;serfHealth&#34; since it is managed automatically
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [INFO] agent: Synced node info
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] agent: Node info in sync
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] agent: Skipping remote check &#34;serfHealth&#34; since it is managed automatically
</span></span><span class=line><span class=cl>    2019/11/20 21:56:09 [DEBUG] agent: Node info in sync
</span></span><span class=line><span class=cl>    2019/11/20 21:56:11 [DEBUG] tlsutil: OutgoingRPCWrapper with version 1</span></span></code></pre></td></tr></table></div></div><h3 id=集群成员>集群成员</h3><p>新开一个终端窗口运行<code>consul members</code>, 就可以看到Consul集群的成员。</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ consul members
</span></span><span class=line><span class=cl>Node          Address         Status  Type    Build  Protocol  DC   Segment
</span></span><span class=line><span class=cl>C02Z35N9LVCF  127.0.0.1:8301  alive   server  1.6.1  2         dc1  &lt;all&gt;</span></span></code></pre></td></tr></table></div></div><p>以上输出显示了我们自己的节点运行的节点、地址、健康状态、自己在集群中的角色、版本信息等。添加<code>-detailed</code>选项可以查看到额外的信息，如下：</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ consul members --detailed
</span></span><span class=line><span class=cl>Node          Address         Status  Tags
</span></span><span class=line><span class=cl>C02Z35N9LVCF  127.0.0.1:8301  alive   acls=0,build=1.6.1:9be6dfc+,dc=dc1,id=2e524113-7caf-643a-80bb-a2fa00c2673b,port=8300,raft_vsn=3,role=consul,segment=&lt;all&gt;,vsn=2,vsn_max=3,vsn_min=2,wan_join_port=8302</span></span></code></pre></td></tr></table></div></div><p><code>members</code>命令的输出是基于gossip协议，它是最终一致的。这意味着，在任何时候，通过你本地Agent看到的结果可能不能准确匹配server的状态。为了查看到一致的信息，可使用HTTP API(将自动转发)到Consul Server上去进行查询：</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ curl localhost:8500/v1/catalog/nodes
</span></span><span class=line><span class=cl>[
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        &#34;ID&#34;: &#34;2e524113-7caf-643a-80bb-a2fa00c2673b&#34;,
</span></span><span class=line><span class=cl>        &#34;Node&#34;: &#34;C02Z35N9LVCF&#34;,
</span></span><span class=line><span class=cl>        &#34;Address&#34;: &#34;127.0.0.1&#34;,
</span></span><span class=line><span class=cl>        &#34;Datacenter&#34;: &#34;dc1&#34;,
</span></span><span class=line><span class=cl>        &#34;TaggedAddresses&#34;: {
</span></span><span class=line><span class=cl>            &#34;lan&#34;: &#34;127.0.0.1&#34;,
</span></span><span class=line><span class=cl>            &#34;wan&#34;: &#34;127.0.0.1&#34;
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;Meta&#34;: {
</span></span><span class=line><span class=cl>            &#34;consul-network-segment&#34;: &#34;&#34;
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;CreateIndex&#34;: 9,
</span></span><span class=line><span class=cl>        &#34;ModifyIndex&#34;: 10
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>]</span></span></code></pre></td></tr></table></div></div><h3 id=停止agent>停止Agent</h3><p>你可以使用 Ctrl-C 优雅的关闭Agent，中断Agent之后你可以看到它离开了集群并关闭.
退出后，Consul提醒其他集群成员，这个节点离开了。如果你强行杀掉进程，集群的其他成员应该能检测到这个节点失效了。当一个成员离开，他的服务和检测也会从目录中移除。当一个成员失效了，他的健康状况被简单的标记为危险，但是不会从目录中移除。Consul会自动尝试对失效的节点进行重连，允许他从某些网络条件下恢复过来。</p><h2 id=注册服务>注册服务</h2><p>在之前的步骤我们运行了第一个agent，看到了集群的成员。现在我们将注册第一个服务并查询这些服务。</p><h3 id=定义一个服务>定义一个服务</h3><p>可以通过提供服务定义或者调用HTTP API来注册一个服务，服务定义文件是注册服务的最通用的方式。</p><p>首先，为Consul配置创建一个目录：</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo mkdir /etc/consul.d</span></span></code></pre></td></tr></table></div></div><p>然后，编写服务定义配置文件。假设我们有一个名叫web的服务运行在 80端口。另外，我们将给他设置一个标签，这样我们可以使用它作为额外的查询方式：</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;{&#34;service&#34;: {&#34;name&#34;: &#34;web&#34;, &#34;tags&#34;: [&#34;rails&#34;], &#34;port&#34;: 80}}&#39; &gt; /etc/consul.d/web.json</span></span></code></pre></td></tr></table></div></div><p>重新启动Agent，设置配置目录：</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo consul agent -dev -config-dir /etc/consul.d/web.json
</span></span><span class=line><span class=cl>==&gt; Starting Consul agent...
</span></span><span class=line><span class=cl>           Version: &#39;v1.6.1&#39;
</span></span><span class=line><span class=cl>           Node ID: &#39;feba8d74-4a3a-9b42-305f-eea7da207c9c&#39;
</span></span><span class=line><span class=cl>         Node name: &#39;C02Z35N9LVCF&#39;
</span></span><span class=line><span class=cl>        Datacenter: &#39;dc1&#39; (Segment: &#39;&lt;all&gt;&#39;)
</span></span><span class=line><span class=cl>            Server: true (Bootstrap: false)
</span></span><span class=line><span class=cl>       Client Addr: [127.0.0.1] (HTTP: 8500, HTTPS: -1, gRPC: 8502, DNS: 8600)
</span></span><span class=line><span class=cl>      Cluster Addr: 127.0.0.1 (LAN: 8301, WAN: 8302)
</span></span><span class=line><span class=cl>           Encrypt: Gossip: false, TLS-Outgoing: false, TLS-Incoming: false, Auto-Encrypt-TLS: false
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>==&gt; Log data will now stream in as it occurs:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [DEBUG] agent: Using random ID &#34;feba8d74-4a3a-9b42-305f-eea7da207c9c&#34; as node ID
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [DEBUG] tlsutil: Update with version 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [DEBUG] tlsutil: OutgoingRPCWrapper with version 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO]  raft: Initial configuration (index=1): [{Suffrage:Voter ID:feba8d74-4a3a-9b42-305f-eea7da207c9c Address:127.0.0.1:8300}]
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO]  raft: Node at 127.0.0.1:8300 [Follower] entering Follower state (Leader: &#34;&#34;)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] serf: EventMemberJoin: C02Z35N9LVCF.dc1 127.0.0.1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] serf: EventMemberJoin: C02Z35N9LVCF 127.0.0.1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] consul: Adding LAN server C02Z35N9LVCF (Addr: tcp/127.0.0.1:8300) (DC: dc1)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] consul: Handled member-join event for server &#34;C02Z35N9LVCF.dc1&#34; in area &#34;wan&#34;
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] agent: Started DNS server 127.0.0.1:8600 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] agent: Started DNS server 127.0.0.1:8600 (udp)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] agent: Started HTTP server on 127.0.0.1:8500 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] agent: Started gRPC server on 127.0.0.1:8502 (tcp)
</span></span><span class=line><span class=cl>    2019/11/20 22:17:29 [INFO] agent: started state syncer
</span></span><span class=line><span class=cl>==&gt; Consul agent running!
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [WARN]  raft: Heartbeat timeout from &#34;&#34; reached, starting election
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO]  raft: Node at 127.0.0.1:8300 [Candidate] entering Candidate state in term 2
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [DEBUG] raft: Votes needed: 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [DEBUG] raft: Vote granted from feba8d74-4a3a-9b42-305f-eea7da207c9c in term 2. Tally: 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO]  raft: Election won. Tally: 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO]  raft: Node at 127.0.0.1:8300 [Leader] entering Leader state
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO] consul: cluster leadership acquired
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO] consul: New leader elected: C02Z35N9LVCF
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO] connect: initialized primary datacenter CA with provider &#34;consul&#34;
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [DEBUG] consul: Skipping self join check for &#34;C02Z35N9LVCF&#34; since the cluster is too small
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO] consul: member &#39;C02Z35N9LVCF&#39; joined, marking health alive
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [DEBUG] agent: Skipping remote check &#34;serfHealth&#34; since it is managed automatically
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [INFO] agent: Synced service &#34;web&#34;
</span></span><span class=line><span class=cl>    2019/11/20 22:17:30 [DEBUG] agent: Node info in sync
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] tlsutil: OutgoingRPCWrapper with version 1
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] agent: Skipping remote check &#34;serfHealth&#34; since it is managed automatically
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] agent: Service &#34;web&#34; in sync
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] agent: Node info in sync
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] agent: Service &#34;web&#34; in sync
</span></span><span class=line><span class=cl>    2019/11/20 22:17:32 [DEBUG] agent: Node info in sync</span></span></code></pre></td></tr></table></div></div><p>日志中的<code>Synced service 'web'</code>表示Agent从配置文件中载入了服务定义，并且成功注册到服务目录。</p><p>如果想注册多个服务，就可以在Consul配置目录创建多个服务定义文件。</p><h3 id=查询服务>查询服务</h3><p>一旦Agent启动并且服务同步了，我们可就以通过DNS或者HTTP API来查询服务。</p><h4 id=dns-api>DNS API</h4><p>我们首先使用DNS API来查询。在DNS API中，服务的DNS名字是 <code>NAME.service.consul</code>。虽然是可配置的，但默认的所有DNS名字会都在consul命名空间下，这个子域告诉Consul，我们在查询服务，<code>NAME</code>则是服务的名称.</p><p>对于我们上面注册的Web服务.它的域名是 <code>web.service.consul</code>:</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ dig @127.0.0.1 -p 8600 web.service.consul
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 web.service.consul
</span></span><span class=line><span class=cl>; (1 server found)
</span></span><span class=line><span class=cl>;; global options: +cmd
</span></span><span class=line><span class=cl>;; Got answer:
</span></span><span class=line><span class=cl>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 27222
</span></span><span class=line><span class=cl>;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2
</span></span><span class=line><span class=cl>;; WARNING: recursion requested but not available
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; OPT PSEUDOSECTION:
</span></span><span class=line><span class=cl>; EDNS: version: 0, flags:; udp: 4096
</span></span><span class=line><span class=cl>;; QUESTION SECTION:
</span></span><span class=line><span class=cl>;web.service.consul.                IN        A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; ANSWER SECTION:
</span></span><span class=line><span class=cl>web.service.consul.        0        IN        A        127.0.0.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; ADDITIONAL SECTION:
</span></span><span class=line><span class=cl>web.service.consul.        0        IN        TXT        &#34;consul-network-segment=&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; Query time: 8 msec
</span></span><span class=line><span class=cl>;; SERVER: 127.0.0.1#8600(127.0.0.1)
</span></span><span class=line><span class=cl>;; WHEN: Wed Nov 20 22:26:14 CST 2019
</span></span><span class=line><span class=cl>;; MSG SIZE  rcvd: 99</span></span></code></pre></td></tr></table></div></div><p>如你所见,一个A记录返回了一个可用的服务所在的节点的IP地址。A记录只能设置为IP地址，有也可用使用 DNS API 来接收包含地址和端口的 <code>SRV</code> 记录：</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ dig @127.0.0.1 -p 8600 web.service.consul SRV
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @127.0.0.1 -p 8600 web.service.consul SRV
</span></span><span class=line><span class=cl>; (1 server found)
</span></span><span class=line><span class=cl>;; global options: +cmd
</span></span><span class=line><span class=cl>;; Got answer:
</span></span><span class=line><span class=cl>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 49043
</span></span><span class=line><span class=cl>;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 3
</span></span><span class=line><span class=cl>;; WARNING: recursion requested but not available
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; OPT PSEUDOSECTION:
</span></span><span class=line><span class=cl>; EDNS: version: 0, flags:; udp: 4096
</span></span><span class=line><span class=cl>;; QUESTION SECTION:
</span></span><span class=line><span class=cl>;web.service.consul.                IN        SRV
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; ANSWER SECTION:
</span></span><span class=line><span class=cl>web.service.consul.        0        IN        SRV        1 1 80 C02Z35N9LVCF.node.dc1.consul.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; ADDITIONAL SECTION:
</span></span><span class=line><span class=cl>C02Z35N9LVCF.node.dc1.consul. 0        IN        A        127.0.0.1
</span></span><span class=line><span class=cl>C02Z35N9LVCF.node.dc1.consul. 0        IN        TXT        &#34;consul-network-segment=&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>;; Query time: 1 msec
</span></span><span class=line><span class=cl>;; SERVER: 127.0.0.1#8600(127.0.0.1)
</span></span><span class=line><span class=cl>;; WHEN: Wed Nov 20 22:28:14 CST 2019
</span></span><span class=line><span class=cl>;; MSG SIZE  rcvd: 147</span></span></code></pre></td></tr></table></div></div><p><code>SRV</code>记录告诉我们 web 这个服务运行于节点<code>C02Z35N9LVCF.node.dc1.consul</code> 的80端口，DNS额外返回了节点的A记录。</p><p>最后，我们也可以用 DNS API 通过标签来过滤服务，基于标签的服务查询格式为<code>TAG.NAME.service.consul</code>。在下面的例子中，我们请求Consul返回有 rails标签的 web服务：</p><div class=highlight id=id-12><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ dig @127.0.0.1 -p 8600 rails.web.service.consul SRV
</span></span><span class=line><span class=cl># 输出信息略</span></span></code></pre></td></tr></table></div></div><h4 id=http-api>HTTP API</h4><p>除了DNS API之外，也可以使用HTTP API查询所有服务实例：</p><div class=highlight id=id-13><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ curl http://localhost:8500/v1/catalog/service/web
</span></span><span class=line><span class=cl>[
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        &#34;ID&#34;: &#34;feba8d74-4a3a-9b42-305f-eea7da207c9c&#34;,
</span></span><span class=line><span class=cl>        &#34;Node&#34;: &#34;C02Z35N9LVCF&#34;,
</span></span><span class=line><span class=cl>        &#34;Address&#34;: &#34;127.0.0.1&#34;,
</span></span><span class=line><span class=cl>        &#34;Datacenter&#34;: &#34;dc1&#34;,
</span></span><span class=line><span class=cl>        &#34;TaggedAddresses&#34;: {
</span></span><span class=line><span class=cl>            &#34;lan&#34;: &#34;127.0.0.1&#34;,
</span></span><span class=line><span class=cl>            &#34;wan&#34;: &#34;127.0.0.1&#34;
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;NodeMeta&#34;: {
</span></span><span class=line><span class=cl>            &#34;consul-network-segment&#34;: &#34;&#34;
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;ServiceKind&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>        &#34;ServiceID&#34;: &#34;web&#34;,
</span></span><span class=line><span class=cl>        &#34;ServiceName&#34;: &#34;web&#34;,
</span></span><span class=line><span class=cl>        &#34;ServiceTags&#34;: [
</span></span><span class=line><span class=cl>            &#34;rails&#34;
</span></span><span class=line><span class=cl>        ],
</span></span><span class=line><span class=cl>        &#34;ServiceAddress&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>        &#34;ServiceWeights&#34;: {
</span></span><span class=line><span class=cl>            &#34;Passing&#34;: 1,
</span></span><span class=line><span class=cl>            &#34;Warning&#34;: 1
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;ServiceMeta&#34;: {},
</span></span><span class=line><span class=cl>        &#34;ServicePort&#34;: 80,
</span></span><span class=line><span class=cl>        &#34;ServiceEnableTagOverride&#34;: false,
</span></span><span class=line><span class=cl>        &#34;ServiceProxy&#34;: {
</span></span><span class=line><span class=cl>            &#34;MeshGateway&#34;: {}
</span></span><span class=line><span class=cl>        },
</span></span><span class=line><span class=cl>        &#34;ServiceConnect&#34;: {},
</span></span><span class=line><span class=cl>        &#34;CreateIndex&#34;: 10,
</span></span><span class=line><span class=cl>        &#34;ModifyIndex&#34;: 10
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>]</span></span></code></pre></td></tr></table></div></div><p>只查看健康服务实例的方法：</p><div class=highlight id=id-14><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ curl http://localhost:8500/v1/catalog/service/web?passing
</span></span><span class=line><span class=cl># 输出信息略</span></span></code></pre></td></tr></table></div></div><h3 id=更新服务>更新服务</h3><p>服务定义可以通过修改配置文件并发送<code>SIGHUP</code>给Agent来进行更新，这样可以在不关闭服务或者保持服务请求可用的情况下进行更新。</p><p>参考来源：</p><ol><li><a href=https://github.com/hashicorp/consul target=_blank rel="external nofollow noopener noreferrer">https://github.com/hashicorp/consul<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li><a href=https://www.consul.io/intro/getting-started.html target=_blank rel="external nofollow noopener noreferrer">https://www.consul.io/intro/getting-started.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li><a href=https://book-consul-guide.vnzmi.com/01_what_is_consul.html target=_blank rel="external nofollow noopener noreferrer">https://book-consul-guide.vnzmi.com/01_what_is_consul.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li></ol></div><div class=post-reward><div class=comment>Buy me a coffee~</div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=static><div><img loading=lazy src=/images/wechatpay.png srcset="/images/wechatpay.png, /images/wechatpay.png 1.5x, /images/wechatpay.png 2x" sizes=auto data-title="chuxing 微信" data-alt="chuxing 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span data-animation>微信</span></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2022-12-10 14:35:38">更新于 2022-12-10&nbsp;<a class=git-hash href=https://github.com/xzygis/xzygis.github.io/commit/7f415305a8bfeea38ce6b8ff33483aeee48262b7 rel="external nofollow noopener noreferrer" target=_blank title="commit by eagle(crackcosmas@gmail.com) 7f415305a8bfeea38ce6b8ff33483aeee48262b7: 修改文章分类"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>7f41530</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/manual-of-consul/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://github.com/xzygis/xzygis.github.io/edit/main/content/posts/2020/Manual-of-consul.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://xzygis.github.io/posts/manual-of-consul/ data-title=Consul入门手册 data-hashtags=Consul><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://xzygis.github.io/posts/manual-of-consul/ data-hashtag=Consul><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://xzygis.github.io/posts/manual-of-consul/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://xzygis.github.io/posts/manual-of-consul/ data-title=Consul入门手册 data-ralateuid=xzygis><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/consul/ class=post-tag>Consul</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/usage-of-json-web-token/ class=post-nav-item rel=prev title="JSON Web Token入门手册"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>JSON Web Token入门手册</a>
<a href=/posts/introduction-of-websocket/ class=post-nav-item rel=next title=Websocket介绍>Websocket介绍<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/ rel="external nofollow noopener noreferrer">Valine</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.115.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/xzygis target=_blank rel="external nofollow noopener noreferrer">chuxing</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/xzygis/xzygis.github.io title="在 GitHub 上查看程式碼，訂閱請點 Watch" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:var(--fi-success);--bg-progress-dark:var(--fi-success-dark)></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/valine/Valine.min.js></script><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/twemoji/twemoji.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script src=/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,valine:{appId:"FZOoctDsbsjlalvygCgbk2AK-gzGzoHsz",appKey:"1xmXqKigfmr7DhTcxfby7KL1",avatar:"wavatar",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!0,highlight:!0,lang:"zh-CN",meta:["nick","mail","link"],pageSize:10,placeholder:`ヾﾉ≧∀≦)o~ 有事请留言！
评论功能以邮件作为通知方式！
如有必要请填写正确邮箱哦！`,recordIP:!0,visitor:!0}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{algoliaAppID:"MTJNHU0JVB",algoliaIndex:"index",algoliaSearchKey:"5486225134d99f43826da401ee9bad57",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},twemoji:!0,watermark:{appendto:".wrapper>main",colspacing:30,content:'<img style="height: 0.85rem;" src="/logo.png" alt="logo" /> 楚兴',enable:!0,fontfamily:"MMT_LRH,沐目体",fontsize:1.1,height:20,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YPVLJZ991S",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-YPVLJZ991S" async></script></body></html>